
<%= form_tag charges_path, id:"chargeForm" do %>
  <article>
    <% if flash[:error].present? %>
      <div id="error_explanation">
        <p><%= flash[:error] %></p>
      </div>
    <% end %>

  </article>

  <script src="https://checkout.stripe.com/checkout.js"> </script>
<%= hidden_field_tag 'stripeToken' %>
<%= hidden_field_tag 'stripeEmail' %>
<%= hidden_field_tag 'amount', 2999 %>
<button id="btn-buy" class="btn btn-md btn-light">buy now</button>

    <script>
    var handler = StripeCheckout.configure({
    key:'<%= Rails.configuration.stripe[:publishable_key] %>',
    token: function(token, arg) {
      document.getElementById('stripeToken').value= token.id;
        document.getElementById('stripeEmail').value = token.email;
          document.getElementById('chargeForm').submit();
    }
  });
  document.getElementById('btn-buy').addEventListener('click', function(e)
{
  handler.open({
    name: 'One month',
    description: 'one month listing at zober',
    amount: document.getElementById('amount').value
  });
  e.preventDefault();
});
          </script>
<% end %>
