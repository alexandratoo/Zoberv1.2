<section>
  <%= render "layouts/header" %>
</section>

<body>
  <div class='app-wrapper'>
    <div class='map-area'>
      <div id="googleMap"> </div>
      <div id="legend"><h3>Legend</h3></div>
    </div>

    <div class='sidebar'>
      <% @houses.each do |house| %>
        <img class="card-img-top" src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d9/Hipping_Hall_2.jpg/320px-Hipping_Hall_2.jpg" alt="Card image cap">
        <div class="card-block">
          <p class="description"> <%= house.room_description %> </p>
          <p class= "name"> <%= house.name %> </p>
          <p class="price"> <%=number_to_currency(house.price)%> </p>
        </div>
      <%end%>
    </div>
  </div>
</body>

<section>
  <%= render "layouts/footer_main" %>
</section>

<script>
  function myMap() {
    const mapProp = {
        center: new google.maps.LatLng(37.7576171,-122.5776844),
        zoom: 12,
        styles: [
          {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
          {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
          {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
          {
            featureType: 'administrative.locality',
            elementType: 'labels.text.fill',
            stylers: [{color: '#d59563'}]
          },
          {
            featureType: 'poi',
            elementType: 'labels.text.fill',
            stylers: [{color: '#d59563'}]
          },
          {
            featureType: 'poi.park',
            elementType: 'geometry',
            stylers: [{color: '#263c3f'}]
          },
          {
            featureType: 'poi.park',
            elementType: 'labels.text.fill',
            stylers: [{color: '#6b9a76'}]
          },
          {
            featureType: 'road',
            elementType: 'geometry',
            stylers: [{color: '#38414e'}]
          },
          {
            featureType: 'road',
            elementType: 'geometry.stroke',
            stylers: [{color: '#212a37'}]
          },
          {
            featureType: 'road',
            elementType: 'labels.text.fill',
            stylers: [{color: '#9ca5b3'}]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry',
            stylers: [{color: '#746855'}]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry.stroke',
            stylers: [{color: '#1f2835'}]
          },
          {
            featureType: 'road.highway',
            elementType: 'labels.text.fill',
            stylers: [{color: '#f3d19c'}]
          },
          {
            featureType: 'transit',
            elementType: 'geometry',
            stylers: [{color: '#2f3948'}]
          },
          {
            featureType: 'transit.station',
            elementType: 'labels.text.fill',
            stylers: [{color: '#d59563'}]
          },
          {
            featureType: 'water',
            elementType: 'geometry',
            stylers: [{color: '#17263c'}]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.fill',
            stylers: [{color: '#515c6d'}]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.stroke',
            stylers: [{color: '#17263c'}]
          }
        ]
    };
    var map = new google.maps.Map(document.getElementById("googleMap"),mapProp);

    // var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
    // var icons = {
    //   parking: {
    //     name: 'provider',
    //     icon: iconBase + 'parking_lot_maps.png'
    //   }
    // };
    var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
    var icons = {
      parking: {
        name: 'Parking',
        icon: iconBase + 'parking_lot_maps.png'
      },
      library: {
        name: 'Library',
        icon: iconBase + 'library_maps.png'
      },
      info: {
        name: 'Info',
        icon: iconBase + 'info-i_maps.png'
      }
    };

    var features = [{
      position: new google.maps.LatLng(37.7576171,-122.4976844),
      type: 'info'
     }, {
      position: new google.maps.LatLng(37.7576171,-122.4875824),
      type: 'info'
     }, {
      position: new google.maps.LatLng(37.7876172,-122.4776854),
      type: 'info'
     }, {
      position: new google.maps.LatLng(37.7376171,-122.4776874),
      type: 'info'
     }, {
      position: new google.maps.LatLng(37.7476172,-122.4776844),
      type: 'info'
    }];

    var legend = document.getElementById('legend');
    var type = icons['info'];
    var name = type.name;
    var icon = type.icon;
    var div = document.createElement('div');
    div.innerHTML = '<img src="' + icon + '"> ' + `<span class="legend-items">${name}</span>`;
    legend.appendChild(div);

    var contentString = '<div id="content">'+
        '<div id="siteNotice">'+
        '</div>'+
        '<h1 id="firstHeading" class="firstHeading">Sober on the Coast</h1>'+
        '<div id="bodyContent">'+
        '<br><a style="color: orange; font-size: 4rem;" href="zober.co">zober.co</a>'+
        '<p><b>Company:</b> Zober LLC' +
        '(303)445-2114'+
        '<p>Bacon ipsum dolor amet spare ribs fatback short loin cow picanha.'+
        ' Prosciutto tri-tip flank, rump shankle burgdoggen filet mignon t-bone strip steak tongue shank. '+
        'Heritage Site.</p>'+

        '<p>Attribution: Uluru, <a style="color: orange;" href="https://en.wikipedia.org/w/index.php?title=Uluru&oldid=297882194">'+
        'https://en.wikipedia.org/w/index.php?title=Uluru</a> '+
        '(last visited Jan 10, 2018).</p>'+
        '</div>'+
        '</div>';

    var infowindow = new google.maps.InfoWindow({
      content: contentString
    });

    var marker = new google.maps.Marker({
      position: new google.maps.LatLng(37.7476171,-122.5076844),
      map: map,
      title: 'Uluru (Ayers Rock)'
    });
    marker.addListener('click', function() {
      infowindow.open(map, marker);
    });

    features.forEach((feature) => {
      var marker = new google.maps.Marker({
        position: feature.position,
        icon: icons[feature.type].icon,
        map: map
      });

      map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);
    });

  }
</script>

<script src="https://maps.googleapis.com/maps/api/js?key= + <%#ENV['GOOGLE_MAP_API_KEY'], don't have env file so using a temp key%> <%="AIzaSyAvIU6QYS7hKm6JNGrNkyBFZ9vuzUsnzaU"%> + &callback=myMap"></script>
